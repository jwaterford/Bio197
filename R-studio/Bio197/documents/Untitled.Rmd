---
title: "JW_Data_Pipelines"
author: "James Waterford"
date: "2023-03-07"
output: html_document
---
```{r}
library(dplyr)
```
## There are two main ways to run a code:

### Nested Code


This method involves running mulitple codes in a single line.
```{r}
numbers <- 1:300
mean(numbers)
sqrt(mean(numbers))
```

### Sequential Code


This method generates intermediate variables to perform statistics on.

```{r}
numbers <- -300:456
mn <- mean(numbers)
sqrt(mn)
```

```{r}
library(readr)
surveys <- read_csv("197-raw_storage/surveys.csv")
species_data <- read.csv( "197-raw_storage/species.csv")
plots_data <- read.csv("197-raw_storage/plots.csv")
```


```{r dplyr, echo=FALSE}
library(dplyr)
surveys1 <- select(surveys, year, month, day, species_id)
head(surveys1)

surveys2 <- select(surveys, year, species_id, weight)
mutate(surveys2, weight_kg = weight*1000)
surveys2
arrange(surveys2, weight_kg)

```


```{r cars}
summary(cars)
```

## Pipe 

Pipes can be implemented in R with the `dplyr` package, and the `margittr` package.

The orginal symbol of the pipe is `%>%`.
However, we can also use `|>` for the same effect.

The purpose of this pipe is to eliminate or reduce the need of intermediate variables.


```{r pipe}
library(magrittr)
1:300 |> mean() |> sqrt() -> mean_square
```

When we use a pipeline, we don't need to plug in the variable name every time.
This was a good practice run, but let's load some real data now.

Let's calculate the median year of surveys.
``` {r}
library(readr)
surveys <- read_csv("../197-raw_storage/surveys.csv")
surveys$year |> median()
```
Let's try calculating the mean of the weight. Because there are NAs in our weight column, we'll need to remove these.
```{r}
surveys$weight |> mean(na.rm=TRUE)
```

## Data Manipulation Practice

```{r}

surveys2 <- select(surveys, year, species_id, weight) |> 
  mutate(weight_kg = weight/1000) |> 
  filter(!is.na(weight_kg)) |>
  select(year, species_id, weight_kg)

str(surveys2)
# surveys[ , c(1,3)]
# surveys[ , c("year", "weight_kg")]
```
